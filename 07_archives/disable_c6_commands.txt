# AMD C6ステート無効化コマンド
# 調査PC (192.168.111.163) で実行してください
# PowerShellで以下のコマンドを順番に実行

# ============================================
# 個別実行版（1行ずつコピー＆ペースト）
# ============================================

# 1. C6ステート（プロセッサアイドル）を無効化
powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 5d76a2ca-e8c0-402f-a133-2158492d58ad 1

# 2. プロセッサパーキングを無効化（C6関連）
powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 0cc5b647-c1df-4637-891a-dec35c318583 0

# 3. AMD特有のアイドル最適化を無効化
powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 3b04d4fd-1cc7-4f23-ab1c-d1337819c4bb 0

# 4. プロセッサアイドル無効化の閾値設定
powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 4e4450b3-6179-4e91-b8f1-5bb9938f81a1 100

# 5. 設定を適用
powercfg /setactive 381b4222-f694-41f0-9685-ff5bb260df2e

# 6. 設定確認（C6ステート状態）
powercfg /query 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 5d76a2ca-e8c0-402f-a133-2158492d58ad

# ============================================
# 一括実行版（全コマンドを1行で実行）
# ============================================

powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 5d76a2ca-e8c0-402f-a133-2158492d58ad 1; powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 0cc5b647-c1df-4637-891a-dec35c318583 0; powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 3b04d4fd-1cc7-4f23-ab1c-d1337819c4bb 0; powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 4e4450b3-6179-4e91-b8f1-5bb9938f81a1 100; powercfg /setactive 381b4222-f694-41f0-9685-ff5bb260df2e

# ============================================
# 確認コマンド
# ============================================

# 現在の電源プラン確認
powercfg /getactivescheme

# プロセッサ電源管理設定の詳細確認
powercfg /query scheme_current sub_processor

# C6ステート無効化の確認（値が1なら無効化成功）
powercfg /query 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 5d76a2ca-e8c0-402f-a133-2158492d58ad

# ============================================
# 元に戻す場合のコマンド
# ============================================

# C6ステートを有効に戻す
powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 5d76a2ca-e8c0-402f-a133-2158492d58ad 0

# プロセッサパーキングを有効に戻す
powercfg /setacvalueindex 381b4222-f694-41f0-9685-ff5bb260df2e 54533251-82be-4824-96c1-47b60b740d00 0cc5b647-c1df-4637-891a-dec35c318583 100

# 設定適用
powercfg /setactive 381b4222-f694-41f0-9685-ff5bb260df2e

# ============================================
# 備考
# ============================================
# これらの設定により、AMD Ryzen 9 6900HXのC6ステート関連の
# シャットダウン問題が解決される可能性があります。
# 設定後、30分程度の安定性テストを実施してください。